levels(df4$W1nssecfam)[levels(df4$W1nssecfam)%in% c("8")] <- "unemployed"
levels(df4$W1nssecfam)
levels(df4$W1heposs9YP)[levels(df4$W1heposs9YP)%in% c("1", "2")] <- "likely"
levels(df4$W1heposs9YP)[levels(df4$W1heposs9YP)%in% c("3", "4")] <- "unlikely"
levels(df4$W1heposs9YP)
levels(df4$W1truantYP)
levels(df4$W2depressYP)[levels(df4$W2depressYP)%in% c("1", "2")] <- "notdepressed"
levels(df4$W2depressYP)[levels(df4$W2depressYP)%in% c("3", "4")] <- "depressed"
levels(df4$W2depressYP)
levels(df4$W4CannTryYP)
levels(df4$W4RacismYP)
levels(df4$W4Childck1YP)
levels(df4$W4AlcFreqYP)[levels(df4$W4AlcFreqYP)%in% c("1", "2", "3")] <- "frequentdrinker"
levels(df4$W4AlcFreqYP)[levels(df4$W4AlcFreqYP)%in% c("4", "5", "6")] <- "nonfrequentdrinker"
levels(df4$W4AlcFreqYP)
levels(df4$W4NamesYP)
levels(df4$W4empsYP)[levels(df4$W4empsYP)%in% c("1", "2")] <- "working"
levels(df4$W4empsYP)[levels(df4$W4empsYP)%in% c("3", "4")] <- "fteducation"
levels(df4$W4empsYP)[levels(df4$W4empsYP)%in% c("5")] <- "nonemployednonstudent"
levels(df4$W4empsYP)[levels(df4$W4empsYP)%in% c("6", "7", "8")] <- "adversecircumstances"
levels(df4$W4empsYP)[levels(df4$W4empsYP)%in% c("9")] <- "missing"
levels(df4$W4empsYP)
levels(df4$W6JobYP)
levels(df4$W6UnivYP)
levels(df4$W6gcse)[levels(df4$W6gcse)%in% c("3")] <- "missing"
levels(df4$W6gcse)
levels(df4$W6als)[levels(df4$W6als)%in% c("3")] <- "missing"
levels(df4$W6als)
levels(df4$W6Childliv)
levels(df4$W6NEETAct)[levels(df4$W6NEETAct)%in% c("1", "2")] <- "paidwork/family"
levels(df4$W6NEETAct)[levels(df4$W6NEETAct)%in% c("3")] <- "somethingelse"
levels(df4$W6NEETAct)
levels(df4$W8DDEGP)
levels(df4$W8DMARSTAT)[levels(df4$W8DMARSTAT)%in% c("2", "6")] <- "couples"
levels(df4$W8DMARSTAT)[levels(df4$W8DMARSTAT)%in% c("1", "3", "4", "5", "7", "8", "9")] <- "single"
levels(df4$W8DMARSTAT)
levels(df4$W8DACTIVITYC)[levels(df4$W8DACTIVITYC)%in% c("1","2", "6")] <- "paidwork"
levels(df4$W8DACTIVITYC)[levels(df4$W8DACTIVITYC)%in% c("5")] <- "fteducation"
levels(df4$W8DACTIVITYC)[levels(df4$W8DACTIVITYC)%in% c( "3", "4", "7")] <- "unpaid/unemp/training"
levels(df4$W8DACTIVITYC)[levels(df4$W8DACTIVITYC)%in% c("8","9")] <- "adversecircumstances"
levels(df4$W8DACTIVITYC)[levels(df4$W8DACTIVITYC)%in% c("10")] <- "missing"
levels(df4$W8DACTIVITYC)
levels(df4$W8CMSEX)[levels(df4$W8CMSEX)%in% c("1")] <- "male"
levels(df4$W8CMSEX)[levels(df4$W8CMSEX)%in% c("2")] <- "female"
levels(df4$W8CMSEX)
levels(df4$W8TENURE)[levels(df4$W8TENURE)%in% c("1","2")] <- "ownership"
levels(df4$W8TENURE)[levels(df4$W8TENURE)%in% c("3", "4", "5", "7")] <- "rental"
levels(df4$W8TENURE)[levels(df4$W8TENURE)%in% c("6")] <- "squatters"
levels(df4$W8TENURE)
levels(df4$W8QMAFI)[levels(df4$W8QMAFI)%in% c("1","2")] <- "high"
levels(df4$W8QMAFI)[levels(df4$W8QMAFI)%in% c("3")] <- "med"
levels(df4$W8QMAFI)[levels(df4$W8QMAFI)%in% c( "4", "5")] <- "low"
levels(df4$W8QMAFI)
levels(df4$W1empsdad)[levels(df4$W1empsdad)%in% c("1")] <- ">30H paid work"
levels(df4$W1empsdad)[levels(df4$W1empsdad)%in% c("2")] <- "<30H paid work"
levels(df4$W1empsdad)[levels(df4$W1empsdad)%in% c("3","4","5","6","7","8")] <- "Currently not working"
levels(df4$W1empsdad)[levels(df4$W1empsdad)%in% c("9")] <- "missing"
levels(df4$W1empsdad)
levels(df4$W1wrk1aMP)[levels(df4$W1wrk1aMP)%in% c("1","2","3","4")] <- "Employed"
levels(df4$W1wrk1aMP)[levels(df4$W1wrk1aMP)%in% c("5", "6", "7", "8", "9", "10", "11")] <- "Unemployed"
levels(df4$W1wrk1aMP)[levels(df4$W1wrk1aMP)%in% c("12")] <- "missing"
levels(df4$W1wrk1aMP)
levels(df4$W8DWRK)[levels(df4$W8DWRK)%in% c("1")] <- "Employed"
levels(df4$W8DWRK)[levels(df4$W8DWRK)%in% c("2")] <- "Unemployed"
levels(df4$W8DWRK)
levels(df4$W6acqno)[levels(df4$W6acqno)%in% c("1","2")] <- "Higher Education"
levels(df4$W6acqno)[levels(df4$W6acqno)%in% c("3", "4", "5", "6")] <- "Secondary Education"
levels(df4$W6acqno)[levels(df4$W6acqno)%in% c("7","8","9")] <- "missing"
levels(df4$W6acqno)
levels(df4$W1hous12HH)[levels(df4$W1hous12HH)%in% c("1","2","3")] <- "House Ownership"
levels(df4$W1hous12HH)[levels(df4$W1hous12HH)%in% c("4", "5", "6","7")] <- "Non House Ownership"
levels(df4$W1hous12HH)[levels(df4$W1hous12HH)%in% c("8")] <- "missing"
levels(df4$W1hous12HH)
levels(df4$W1ch0_2HH)[levels(df4$W1ch0_2HH)%in% c("0")] <- "No children"
levels(df4$W1ch0_2HH)[levels(df4$W1ch0_2HH)%in% c("1", "2", "3")] <- "One or more children"
levels(df4$W1ch0_2HH)
levels(df4$W6Apprent1YP)
#Relevel Bases
df4$W4AlcFreqYP<- relevel(df4$W4AlcFreqYP, ref = "nonfrequentdrinker")
df4$W8DMARSTAT<- relevel(df4$W8DMARSTAT, ref = "single")
df4$W8TENURE<- relevel(df4$W8TENURE, ref = "ownership")
df4$W1wrk1aMP<- relevel(df4$W1wrk1aMP, ref = "Unemployed")
df4$W1wrkfullmum <- relevel(df4$W1wrkfullmum, ref = "3") #3 = not working
#remove NA values from the continuous predictors and drop "W8DAGEYCH"
#Drop all correlated predictors & W8DAGEYCH and remove NA values for continuous variables --first model--
df3 <- subset(df4, W1GrssyrMP >= 0 & W1GrssyrHH >= 0 & W1yschat1 >= 0 & W2ghq12scr >= 0 & W4schatYP >= 0 & W6DebtattYP >= 0 & W8DGHQSC >= 0, -c(W8DAGEYCH))
df3 <- subset(df3, select = -c(W8DACTIVITY, W1empsmum, W1empsdad, W1wrk1aMP, W8DWRK, W6acqno, W1hous12HH, W1NoldBroHS,W1ch16_17HH, W1ch0_2HH, W1ch3_11HH, W1ch12_15HH, W6OwnchiDV,W1famtyp2, W5JobYP, W5EducYP, W5Apprent1YP, W6EducYP, W6Apprent1YP, W6EducYP))
#log transform salary predictors
df3$W1GrssyrMP <- log(df3$W1GrssyrMP)
df3$W1GrssyrHH <- log(df3$W1GrssyrHH)
first.lm <-lm(W8DINCW ~., data=df3)
Anova(first.lm)
vif(first.lm)
second.lm <- lm(W8DINCW ~. -W6gcse-W6JobYP-W1truantYP-W1yschat1-W4RacismYP-W4NamesYP-W1alceverYP-W1GrssyrMP-W1bulrc-W8TENURE-W1condur5MP-W6als-W2depressYP-W8DGHQSC-W8QMAFI-W1InCarHH-W4Childck1YP-W2ghq12scr-W1wrkfulldad, data=df3)
Anova(second.lm)
setwd("~/GitHub/Rstudio/Applied-Regression/regression-diagnostic-outlier-analysis")
library(car)
library(ggplot2)
library(arm)
library(gridExtra)
#load the data
nursery_dt <- read.table("NurserySchools.txt", header = TRUE)
head(nursery_dt, 5)
with(nursery_dt, cor(Dep, NurseryExp))
with(nursery_dt, cor(NurseryProv,NurseryExp))
p1 <- ggplot(data = nursery_dt, aes(x=Dep, y= NurseryExp)) + geom_point() + geom_smooth(method = "lm")
p2 <- ggplot(data = nursery_dt, aes(x=NurseryProv , y= NurseryExp)) + geom_point() + geom_smooth(method = "lm")
grid.arrange(p1,p2,nrow=1)
#Q2 remove outlies (max)
out1 <- which(nursery_dt$NurseryExp==max(nursery_dt$NurseryExp))
first_lm <- lm(NurseryExp ~ Dep + NurseryProv , data = nursery_dt)
display(first_lm)
nursery_out.1 <- nursery_dt[-out1,]
imp_first <- lm(NurseryExp ~ Dep + NurseryProv , data = nursery_out.1)
display(imp_first)
(15.85-14.81)/15.85
#Q3
show_outliers<-function(the.linear.model,topN){
#length of data
n=length(fitted(the.linear.model))
#number of parameters estimated
p=length(coef(the.linear.model))
#standardised residuals over 3
res.out<-which(abs(rstandard(the.linear.model))>3) #sometimes >2
#topN values
res.top<-head(rev(sort(abs(rstandard(the.linear.model)))),topN)
#high leverage values
lev.out<-which(lm.influence(the.linear.model)$hat>2*p/n)
#topN values
lev.top<-head(rev(sort(lm.influence(the.linear.model)$hat)),topN)
#high diffits
dffits.out<-which(dffits(the.linear.model)>2*sqrt(p/n))
#topN values
dffits.top<-head(rev(sort(dffits(the.linear.model))),topN)
#Cook's over 1
cooks.out<-which(cooks.distance(the.linear.model)>1)
#topN cooks
cooks.top<-head(rev(sort(cooks.distance(the.linear.model))),topN)
#Create a list with the statistics -- cant do a data frame as different lengths
list.of.stats<-list(Std.res=res.out,Std.res.top=res.top, Leverage=lev.out, Leverage.top=lev.top, DFFITS=dffits.out, DFFITS.top=dffits.top, Cooks=cooks.out,Cooks.top=cooks.top)
#return the statistics
list.of.stats}
outliers.nursery <- show_outliers(first_lm, 5)
influtial.1 <- intersect(outliers.nursery$DFFITS,outliers.nursery$Leverage)
influtial.1
nursery_dt[c(18, 28),][,4]
#question 4
p1<-ggplot(data=nursery_dt, aes(x=Dep,y=NurseryExp))+geom_point()+geom_smooth(method="lm",se=FALSE)
p2<-ggplot()+geom_smooth(data=nursery_dt[-c(18,28),],aes(x=Dep, y=NurseryExp), method="lm", se=FALSE, linetype="dashed")
p1+p2$layers[]
colnames(nursery_dt)
third.lm <- lm(PrimaryExp ~ Dep + MoreSmall, data=nursery_dt)
fourth.lm <- lm(PrimaryExp ~ Dep*MoreSmall, data=nursery_dt)
display(third.lm)
display(fourth.lm)
third.lm <- lm(PrimaryExp ~ Dep + factor(MoreSmall), data=nursery_dt)
display(third.lm)
fourth.lm <- lm(PrimaryExp ~ Dep*factor(MoreSmall), data=nursery_dt)
display(fourth.lm)
p3 <- ggplot(data=nursery_dt, aes(x=Dep, y=PrimaryExp, colour=factor(MoreSmall)))+geom_point()+geom_smooth(method="lm",se=FALSE)
p3
predict(third.lm,data.frame(Dep=80,MoreSmall=0)) - predict(fourth.lm,data.frame(Dep=80,MoreSmall=0))
predict(third.lm,data.frame(Dep=18,MoreSmall=1)) - predict(fourth.lm,data.frame(Dep=18,MoreSmall=1))
#Redidual plots
par(mfrow=c(2,2))
plot(third.lm, which=c(1,2))
hist(rstandard(third.lm), freq = FALSE ,
main="Histogram of standardised residuals",
cex.main=0.8, xlab="Standardised residuals")
range(third.lm$PrimaryExp)
range(nursery_dt$PrimaryExp)
display(third.lm)
third.lm <- lm(PrimaryExp ~ Dep + factor(MoreSmall), data=nursery_dt)
fourth.lm <- lm(PrimaryExp ~ Dep*factor(MoreSmall), data=nursery_dt)
display(third.lm)
display(fourth.lm)
#remove NA values from the continuous predictors and drop "W8DAGEYCH"
#Drop all correlated predictors & W8DAGEYCH and remove NA values for continuous variables --first model--
df3 <- subset(df4, W1GrssyrMP >= 0 & W1GrssyrHH >= 0 & W1yschat1 >= 0 & W2ghq12scr >= 0 & W4schatYP >= 0 & W6DebtattYP >= 0 & W8DGHQSC >= 0, -c(W8DAGEYCH))
df3 <- subset(df3, select = -c(W8DACTIVITY, W1empsmum, W1empsdad, W1wrk1aMP, W8DWRK, W6acqno, W1hous12HH, W1NoldBroHS,W1ch16_17HH, W1ch0_2HH, W1ch3_11HH, W1ch12_15HH, W6OwnchiDV,W1famtyp2, W5JobYP, W5EducYP, W5Apprent1YP, W6EducYP, W6Apprent1YP, W6EducYP))
#log transform salary predictors
df3$W1GrssyrMP <- log(df3$W1GrssyrMP)
df3$W1GrssyrHH <- log(df3$W1GrssyrHH)
first.lm <-lm(W8DINCW ~., data=df3)
second.lm <- lm(W8DINCW ~. -W6gcse-W6JobYP-W1truantYP-W1yschat1-W4RacismYP-W4NamesYP-W1alceverYP-W1GrssyrMP-W1bulrc-W8TENURE-W1condur5MP-W6als-W2depressYP-W8DGHQSC-W8QMAFI-W1InCarHH-W4Childck1YP-W2ghq12scr-W1wrkfulldad, data=df3)
Anova(second.lm)
initial.lm <- lm(formula = W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W1ethgrpYP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W4empsYP + W4schatYP +
W6UnivYP + W6Childliv + W6DebtattYP + W6NEETAct + W8DDEGP +
W8DMARSTAT + W8DACTIVITYC + W8CMSEX, data = df3)
Anova(initial.lm)
display(initial.lm)
range(df3$W8DINCW)
480-156
#Redidual plots
par(mfrow=c(2,2))
plot(initial.lm , which=c(1,2))
hist(rstandard(initial.lm), freq = FALSE ,
main="Histogram of standardised residuals",
cex.main=0.8, xlab="Standardised residuals")
# W1ch0_2HH + W1hous12HH + W6acqno + W1empsdad  W8DWRK W1ch3_11HH (not significant in the current model)
# W6Apprent1YP  + W1wrk1aMP are sig
# W6UnivYP turns non-sig as a result of adding W6Apprent1YP + W1wrk1aMP (sig predictors)
display(initial2.lm)
#add the collinear and significant predictors (W6Apprent1YP,W1ch0_2HH, W1hous12HH, W6acqno,W1empsdad , W1wrk1aMP , W8DWRK, W1ch3_11HH)
df5 <- subset(df4, W1GrssyrMP >= 0 & W1GrssyrHH >= 0 & W1yschat1 >= 0 & W2ghq12scr >= 0 & W4schatYP >= 0 & W6DebtattYP >= 0 & W8DGHQSC >= 0, -c(W8DAGEYCH))
df5 <-  subset(df5, select = -c(W8DACTIVITY, W1empsmum, W1NoldBroHS, W1ch16_17HH, W1ch12_15HH, W6OwnchiDV,W1famtyp2, W5JobYP, W5EducYP, W5Apprent1YP, W6EducYP, W6EducYP))
df5$W1GrssyrMP <- log(df5$W1GrssyrMP)
df5$W1GrssyrHH <- log(df5$W1GrssyrHH)
initial2.lm <- lm(formula = W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W1ethgrpYP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W4empsYP + W4schatYP +
W6Childliv + W6DebtattYP + W6NEETAct + W8DDEGP +
W8DMARSTAT + W8DACTIVITYC + W8CMSEX +
W6Apprent1YP  + W1wrk1aMP, data = df5)
Anova(initial2.lm)
# W1ch0_2HH + W1hous12HH + W6acqno + W1empsdad  W8DWRK W1ch3_11HH (not significant in the current model)
# W6Apprent1YP  + W1wrk1aMP are sig
# W6UnivYP turns non-sig as a result of adding W6Apprent1YP + W1wrk1aMP (sig predictors)
display(initial2.lm)
range(df5$W8DINCW) #the range of the outcome is 324 which is well above residual standard deviation of 38. hence the model is acceptable for making inference about the relationships between the predictors and the outcome
#Redidual plots
par(mfrow=c(2,2))
plot(initial2.lm , which=c(1,2))
hist(rstandard(initial2.lm), freq = FALSE ,
main="Histogram of standardised residuals",
cex.main=0.8, xlab="Standardised residuals")
interaction.2 <- lm(W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W8DDEGP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W1ethgrpYP + W4schatYP +
W6Childliv + W6NEETAct  + W8CMSEX +W4empsYP +
W8DMARSTAT + W8DACTIVITYC + W6Apprent1YP  + W1wrk1aMP +
W6DebtattYP*W8DWRK, data = df5)
Anova(interaction.2) #interaction is sig!!! ~there's an interaction between someone's attitude towards debt and status employment.
display(interaction.2)
Anova(interaction.2) #interaction is sig!!! ~there's an interaction between someone's attitude towards debt and status employment.
interaction.2 <- lm(W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W8DDEGP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W1ethgrpYP + W4schatYP +
W6Childliv + W6NEETAct  + W8CMSEX +W4empsYP +
W8DMARSTAT  + W6Apprent1YP  + W1wrk1aMP +
W6DebtattYP*W8DACTIVITYC, data = df5)
Anova(interaction.2) #interaction is sig!!! ~there's an interaction between someone's attitude towards debt and status employment.
interaction.2 <- lm(W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W8DDEGP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W1ethgrpYP + W4schatYP +
W6Childliv + W6NEETAct  + W8CMSEX +W4empsYP +
W8DMARSTAT  + W6Apprent1YP  + W1wrk1aMP +
W6DebtattYP*W1ethgrpYP, data = df5)
Anova(interaction.2) #interaction is sig!!! ~there's an interaction between someone's attitude towards debt and status employment.
interaction.2 <- lm(W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam  + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W1ethgrpYP + W4schatYP +
W6Childliv + W6NEETAct  + W8CMSEX +W4empsYP +
W8DMARSTAT  + W6Apprent1YP  + W1wrk1aMP + W8DACTIVITYC
W6DebtattYP*W8DDEGP, data = df5)
Anova(interaction.2) #interaction is sig!!! ~there's an interaction between someone's attitude towards debt and status employment.
levels(df5$W8DACTIVITYC)
interaction.2 <- lm(W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W8DDEGP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W1ethgrpYP + W4schatYP +
W6Childliv + W6NEETAct  + W8CMSEX +W4empsYP +
W8DMARSTAT  + W6Apprent1YP  + W1wrk1aMP +
W6DebtattYP*W8DACTIVITYC, data = df5)
Anova(interaction.2) #interaction is sig!!! ~there's an interaction between someone's attitude towards debt and status employment.
#proceed with outlier analysis for the initial model.
p5 <- ggplot(df5, aes(x=W1GrssyrHH, y=W8DINCW)) + geom_point()+ geom_smooth(method = "lm")
p6 <- ggplot(df5, aes(x=W6DebtattYP, y=W8DINCW)) + geom_point()+ geom_smooth(method = "lm")
grid.arrange(p5,p6,nrow=1)
grid.arrange(p5,p6,nrow=2,ncol=1)
# W1ch0_2HH + W1hous12HH + W6acqno + W1empsdad  W8DWRK W1ch3_11HH (not significant in the current model)
# W6Apprent1YP  + W1wrk1aMP are sig
# W6UnivYP turns non-sig as a result of adding W6Apprent1YP + W1wrk1aMP (sig predictors)
display(initial2.lm)
show_outliers<-function(the.linear.model,topN){
#length of data
n=length(fitted(the.linear.model))
#number of parameters estimated
p=length(coef(the.linear.model))
#standardised residuals over 3
res.out<-which(abs(rstandard(the.linear.model))>3) #sometimes >2
#topN values
res.top<-head(rev(sort(abs(rstandard(the.linear.model)))),topN)
#high leverage values
lev.out<-which(lm.influence(the.linear.model)$hat>2*p/n)
#topN values
lev.top<-head(rev(sort(lm.influence(the.linear.model)$hat)),topN)
#high diffits
dffits.out<-which(dffits(the.linear.model)>2*sqrt(p/n))
#topN values
dffits.top<-head(rev(sort(dffits(the.linear.model))),topN)
#Cook's over 1
cooks.out<-which(cooks.distance(the.linear.model)>1)
#topN cooks
cooks.top<-head(rev(sort(cooks.distance(the.linear.model))),topN)
#Create a list with the statistics -- cant do a data frame as different lengths
list.of.stats<-list(Std.res=res.out,Std.res.top=res.top, Leverage=lev.out, Leverage.top=lev.top, DFFITS=dffits.out, DFFITS.top=dffits.top, Cooks=cooks.out,Cooks.top=cooks.top)
#return the statistics
list.of.stats}
Anova(initial2.lm)
outliers <- show_outliers(initial2.lm, 10)
outliers
common.out <- intersect(intersect(outliers$Std.res,outliers$DFFITS),outliers$Leverage)
common.out
common.out <- intersect(outliers$Leverage,outliers$DFFITS)
common.out
df5[common.out,]
summary(df5)
outliers <- show_outliers(initial2.lm, 5)
outliers
common.out <- intersect(outliers$Leverage,outliers$DFFITS)
df5[common.out,]
outliers <- show_outliers(initial2.lm, 15)
outliers
common.out <- intersect(outliers$Leverage.top,outliers$DFFITS.top)
df5[common.out,]
common.out <- intersect(outliers$Leverage.top,outliers$DFFITS.top)
common.out
outliers
outliers$Leverage.top
common.out <- intersect(outliers$Leverage.top,outliers$DFFITS.top)
common.out
common.out <- intersect(outliers$Leverage,outliers$DFFITS)
common.out
influtial.1 <- intersect(outliers.nursery$DFFITS,outliers.nursery$Leverage)
influtial.1
outliers.nursery$DFFITS
outliers.nursery$DFFITS.top
outliers.nursery$Leverage.top[1,]
typeof(outliers.nursery$Leverage.top)
common.out <- intersect(intersect(outliers$Leverage,outliers$DFFITS),outliers$Std.res)
common.out
outliers <- show_outliers(initial2.lm, 10)
outliers
common.out <- intersect(intersect(outliers$Leverage,outliers$DFFITS),outliers$Std.res)
common.out
common.out <- intersect(outliers$Leverage,outliers$DFFITS)
common.out
length(common.out)
df5[common.out,]
outliers_df<- df5[common.out,]
summary(outliers_df)
summary(df5)
df5[-common.out,]
wo.outliers <- lm(formula = W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W1ethgrpYP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W4empsYP + W4schatYP +
W6Childliv + W6DebtattYP + W6NEETAct + W8DDEGP +
W8DMARSTAT + W8DACTIVITYC + W8CMSEX +
W6Apprent1YP  + W1wrk1aMP, data = df5[-common.out])
initial2.lm <- lm(formula = W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W1ethgrpYP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W4empsYP + W4schatYP +
W6Childliv + W6DebtattYP + W6NEETAct + W8DDEGP +
W8DMARSTAT + W8DACTIVITYC + W8CMSEX +
W6Apprent1YP  + W1wrk1aMP, data = df5)
Anova(initial2.lm)
wo.outliers <- lm(formula = W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W1ethgrpYP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W4empsYP + W4schatYP +
W6Childliv + W6DebtattYP + W6NEETAct + W8DDEGP +
W8DMARSTAT + W8DACTIVITYC + W8CMSEX +
W6Apprent1YP  + W1wrk1aMP, data = df5[-common.out,])
Anova(wo.outliers)
display(wo.outliers)
display(initial2.lm)
display(initial2.lm)[,coef.est]
display(initial2.lm)$coefficients[,1]
install.packages("broom")
library(broom)
inititial.coeff<- tidy(initial2.lm)
colnames(inititial.coeff)
wo_outliers.coeff <- tidy(wo.outliers)
initial.coeff<- tidy(initial2.lm)
View(inititial.coeff)
View(inititial.coeff)
wo_outliers.coeff["estimate"]
display(wo.outliers)
abs(wo_outliers.coeff["estimate"] - initial.coeff["estimate"])
abs(wo_outliers.coeff["estimate"] - initial.coeff["estimate"])/initial.coeff["estimate"]
(abs(wo_outliers.coeff["estimate"] - initial.coeff["estimate"]))/initial.coeff["estimate"]
(abs(wo_outliers.coeff["estimate"] - initial.coeff["estimate"]))/abs(initial.coeff["estimate"])
display(wo.outliers)
display(initial2.lm)
initial.coeff["percentage diff"] <- (abs(wo_outliers.coeff["estimate"] - initial.coeff["estimate"]))/abs(initial.coeff["estimate"])
View(inititial.coeff)
View(initial.coeff)
View(initial.coeff)
initial.coeff["percentdiff"] <- (abs(wo_outliers.coeff["estimate"] - initial.coeff["estimate"]))/abs(initial.coeff["estimate"])
select(initial.coeff, estimate, percentdiff)
is.dataframe(select(initial.coeff, term, percentdiff))
is.dataframe(select(initial.coeff, term, percentdiff))
is.data.frame(select(initial.coeff, term, percentdiff))
head(select(initial.coeff, term, percentdiff))[order(percentdiff),]
initial.coeff["percentdiff"] <- (abs(wo_outliers.coeff["estimate"] - initial.coeff["estimate"]))/abs(initial.coeff["estimate"])
head(select(initial.coeff, term, percentdiff))[order(percentdiff),]
head(select(initial.coeff, term, percentdiff)[order(percentdiff),])
select(initial.coeff, term, percentdiff)[order(percentdiff),]
View(initial.coeff)
select(initial.coeff, term, percentdiff)[order(percentdiff),]
select(initial.coeff, term, percentdiff)
colnames(inititial.coeff)[order(percentdiff),]
colnames(inititial.coeff)[order(<dbl>),]
colnames(inititial.coeff)[order(dbl),]
colnames(inititial.coeff)[order("percentdiff"),]
initial.coeff <- initial.coeff[order(percentdiff),]
initial.coeff <- initial.coeff[order(initial.coeff$percentdiff),]
select(initial.coeff, term, percentdiff)
initial.coeff <- initial.coeff[order(-initial.coeff$percentdiff),]
select(initial.coeff, term, percentdiff)
summary(outliers_df)
p7 <- ggplot(df5, aes(x = W1GrssyrHH, y = W8DINCW, color = factor(W8DACTIVITYC)))
p7 <- p7 + geom_point(size = 2)
p7 <- p7 + geom_point(data = df5[common.out, ], color = "red")
p7 <- p7 + geom_smooth(method = "lm", se = FALSE)
p8 <- ggplot() + geom_smooth(data = df5[-common.out,], aes(x = W1GrssyrHH, y = W8DINCW, color = factor(W8DACTIVITYC)), method = "lm", se = FALSE, linetype = "dashed")
p7+p8$layers[]
p7 <- ggplot(df5, aes(x = W1GrssyrHH, y = W8DINCW, color = factor(W8DACTIVITYC)))
p7 <- p7 + geom_point(size = 2)
p7 <- p7 + geom_point(data = df5[common.out, ], color = "black")
p7 <- p7 + geom_smooth(method = "lm", se = FALSE)
p8 <- ggplot() + geom_smooth(data = df5[-common.out,], aes(x = W1GrssyrHH, y = W8DINCW, color = factor(W8DACTIVITYC)), method = "lm", se = FALSE, linetype = "dashed")
p7+p8$layers[]
p7 <- ggplot(df5, aes(x = W1GrssyrHH, y = W8DINCW, color = factor(W8QMAFI)))
p7 <- ggplot(df5, aes(x = W1GrssyrHH, y = W8DINCW, color = factor(W8QMAFI)))
p7 <- p7 + geom_point(size = 2)
p7 <- p7 + geom_point(data = df5[common.out, ], color = "black")
p7 <- p7 + geom_smooth(method = "lm", se = FALSE)
p8 <- ggplot() + geom_smooth(data = df5[-common.out,], aes(x = W1GrssyrHH, y = W8DINCW, color = factor(W8QMAFI)), method = "lm", se = FALSE, linetype = "dashed")
p7+p8$layers[]
p7 <- ggplot(df5, aes(x = W1GrssyrHH, y = W8DINCW, color = factor(W8DMARSTAT)))
p7 <- p7 + geom_point(size = 2)
p7 <- p7 + geom_point(data = df5[common.out, ], color = "black")
p7 <- p7 + geom_smooth(method = "lm", se = FALSE)
p8 <- ggplot() + geom_smooth(data = df5[-common.out,], aes(x = W1GrssyrHH, y = W8DINCW, color = factor(W8DMARSTAT)), method = "lm", se = FALSE, linetype = "dashed")
p7+p8$layers[]
outliers_df<- subset(outliers_df, select = c(W1GrssyrHH, W1hea2MP, W1usevcHH, W1hiqualmum ,W1hiqualdad, W1wrkfullmum, IndSchool , W1marstatmum , W1depkids,
W1nssecfam , W1ethgrpYP ,W1heposs9YP , W1hwndayYP ,W1disabYP,W2disc1YP, W4AlcFreqYP, W4CannTryYP , W4empsYP , W4schatYP ,
W6Childliv , W6DebtattYP , W6NEETAct, W8DDEGP,W8DMARSTAT , W8DACTIVITYC ,W8CMSEX ,W6Apprent1YP  , W1wrk1aMP))
summary(outliers_df)
display(wo.outliers)
display(initial2.lm)
Anova(wo.outliers)
outliers.lm <- lm(W8DINCW ~., data=outliers_df)
outliers_df<- df5[common.out,]
outliers_df<- subset(outliers_df, select = c(W1GrssyrHH, W1hea2MP, W1usevcHH, W1hiqualmum ,W1hiqualdad, W1wrkfullmum, IndSchool , W1marstatmum , W1depkids,
W1nssecfam , W1ethgrpYP ,W1heposs9YP , W1hwndayYP ,W1disabYP,W2disc1YP, W4AlcFreqYP, W4CannTryYP , W4empsYP , W4schatYP ,
W6Childliv , W6DebtattYP , W6NEETAct, W8DDEGP,W8DMARSTAT , W8DACTIVITYC ,W8CMSEX ,W6Apprent1YP  , W1wrk1aMP, W8DINCW))
outliers.lm <- lm(W8DINCW ~., data=outliers_df)
summary(outliers_df)
outliers.lm <- lm(W8DINCW ~.-IndSchoo, data=outliers_df)
outliers.lm <- lm(W8DINCW ~.-IndSchool, data=outliers_df)
summary(wo.outliers)
#residual plots
par(mfrow=c(2,2))
plot(wo.outliers , which=c(1,2))
hist(rstandard(wo.outliers), freq = FALSE ,
main="Histogram of standardised residuals",
cex.main=0.8, xlab="Standardised residuals")
select(initial.coeff, term, percentdiff)
sum(initial.coeff["percentdiff"])
colSums(initial.coeff["percentdiff"])
colSums(initial.coeff[,"percentdiff"])
colSums(initial.coeff[,7])
head(initial.coeff)
head(initial.coeff["percentdiff"])
sum(initial.coeff["percentdiff"])
display(initial2.lm)
display(wo.outliers) #the outliers do not affect the model fit. - R-squared and adjuster R-square barely move.
View(outliers_df)
p7 <- ggplot(df5, aes(x = W1GrssyrHH, y = W8DINCW))
p7 <- p7 + geom_point(size = 2)
p7 <- p7 + geom_point(data = df5[common.out, ], color = "black")
p7 <- p7 + geom_smooth(method = "lm", se = FALSE)
p7
p7 <- p7 + geom_point(data = df5[common.out, ], color = "red")
p7
p5 <- ggplot(df5, aes(x = W1GrssyrHH, y = W8DINCW)) + geom_point(size = 2)
p5 <- p5 + geom_point(data = df5[common.out, ], color = "red") + geom_smooth(method = "lm", se = FALSE)
p6 <- ggplot(df5, aes(x = W6DebtattYP, y = W8DINCW)) + geom_point(size = 2)
p6 <- p6 + geom_point(data = df5[common.out, ], color = "red") + geom_smooth(method = "lm", se = FALSE)
grid.arrange(p5,p6,nrow=2,ncol=1)
head(select(outliers_df, W1nssecfam, W8DMARSTAT, W4empsYP, W1hiqualmum),10)
head(select(outliers_df, W1nssecfam, W8DMARSTAT, W4empsYP, W1hiqualmum, W8DINCW ),10)
head(select(outliers_df, W1nssecfam, W8DMARSTAT, W4empsYP, W1hiqualmum, W8DINCW ),15)
View(initial.coeff)
head(select(outliers_df, W1nssecfam, W8DMARSTAT, W4empsYP, W1hiqualmum, W8DINCW W6NEETA),20)
head(select(outliers_df, W1nssecfam, W8DMARSTAT, W4empsYP, W1hiqualmum, W8DINCW,W6NEETA),20)
head(select(outliers_df, W1nssecfam, W8DMARSTAT, W4empsYP, W1hiqualmum, W8DINCW, W6NEETAct),20)
head(select(outliers_df, W1nssecfam, W8DMARSTAT, W4empsYP, W1hiqualmum, W6NEETAct, W8DINCW),20)
head(select(outliers_df, W1nssecfam, W8DMARSTAT, W4empsYP, W1hiqualmum, W6Childliv, W8DINCW),20)
interaction.2 <- lm(W8DINCW ~ W1GrssyrHH + W1hea2MP + W1usevcHH + W1hiqualmum +
W1hiqualdad + W1wrkfullmum + IndSchool + W1marstatmum + W1depkids +
W1nssecfam + W8DDEGP + W1heposs9YP + W1hwndayYP + W1disabYP +
W2disc1YP + W4AlcFreqYP + W4CannTryYP + W1ethgrpYP + W4schatYP +
W6Childliv + W6NEETAct  + W8CMSEX + W8DACTIVITYC+
W8DMARSTAT  + W6Apprent1YP  + W1wrk1aMP +
W6DebtattYP*W4empsYP, data = df5)
Anova(interaction.2) #interaction is non sig!!! no interaction can be derived between someone's attitude towards debt and status employment.
display(interaction.2)
levels(df5$W4empsYP)
